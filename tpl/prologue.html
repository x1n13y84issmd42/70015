<html>
	<head>
		<link href="https://fonts.googleapis.com/css?family=Abril+Fatface|Share+Tech+Mono|Bungee+Shade|Cinzel:400,700|Cute+Font|Faster+One|Monoton|Permanent+Marker|Quicksand:400,600,700|Special+Elite|Vibes&display=swap" rel="stylesheet">
		<link href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous" rel="stylesheet">
		<link href="./style.css" rel="stylesheet">
		<script src="./app.js"></script>
	</head>
	<body style="display:none;">
		<div id="menu">
			<div>
				<toollink name="base64" tag="base64">Base64</toollink>
				<toollink name="urldecode" tag="url trans encode decode">Transcode URL</toollink>
				<toollink name="urlparse" tag="urlparse">Parse URL</toollink>
			</div>
			
			<div>
				<toollink name="json" tag="json format">Format JSON</toollink>
				<toollink name="jsonyaml" tag="json yaml">JSON &#x2942; YAML</toollink>
				<toollink name="xml" tag="xml xpath">XML &amp; Xpath</toollink>
			</div>
			
			<div>
				<toollink name="unixtime" tag="unittime timestamp">Unixtime</toollink>
				<toollink name="hasher" tag="hash md5 sha des crc">Hashes &amp; ciphers</toollink>
			</div>

			<div class="clear"></div>
		</div>

		<div id="front-center">
			<input type="text" name="" id="filter" autofocus autocomplete="off" placeholder="What's up?">
			<div class="footer">
				<span class="c">© 2019 x1n13y84issmd42</span>
				<span class="pipe"></span>
				<a href="https://github.com/x1n13y84issmd42/70015">GitHub</a>
				<span class="pipe"></span>
				<span class="c">With elitism in ♥</span>
			</div>
		</div>

		<div id="tools"></div>

		<script>
			let config = new LSConfig();
			let bench = new Workbench(config);

			function focus(id) {
				bench.focus(id);
			}

			function unfocus(id) {
				bench.unfocus(id);
				window.location.hash = '';
				filter.focus();
			}

			function offset(e) {
				let res = {
					left: e.offsetLeft,
					top: e.offsetTop,
				};

				let p = e.parentNode;

				while(p) {
					res.left += ~~p.offsetLeft;
					res.top += ~~p.offsetTop;

					p = p.parentNode;
				}

				return res;
			}

			function share() {
				let tool = bench.currentlyEquipped();
				console.log(`Sharing the #${tool.ID} tool!`);
				tool.C.classList.add('bg');

				let toolData = tool.export();
				toolData = btoa(JSON.stringify(toolData));
				let toolURL = `${window.location.href.split('#')[0]}#${tool.ID}@${toolData}`

				document.body.appendChild(XUIC.dialog('share', {
					onclose: () => {
						tool.C.classList.remove('bg');
					},
					value: toolURL,
					title: `Sharing some ${tool.ID} goodness`
				}));
			}

			function onclickCopyToClipboard(e) {
				let from = e.currentTarget;

				//	Looking for a disabled parent.
				let pn = from.parentNode;
				while (pn) {
					if (pn.classList && pn.classList.contains('disabled')) {
						return;
					}
					pn = pn.parentNode;
				}

				if (from.dataset.value) {
					Clipboard.copy(from.dataset.value);
					tmpStyle(from, 'copied', 200);
					copiedFloater(e.pageX, e.pageY);
					return;
				}
				
				if (from.dataset.from) {
					from = document.getElementById(from.dataset.from);
				}
				
				if (from) {	
					switch (from.tagName) {
						case "INPUT":
						case "TEXTAREA":
							Clipboard.copy(from.value);
							break;
							
						default:
							Clipboard.copy(from.innerHTML);
							break;
					}

					tmpStyle(from, 'copied', 200);
					copiedFloater(e.pageX, e.pageY);
				}
			}
		</script>
