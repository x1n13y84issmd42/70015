
<html>
	<head>
		<link href="https://fonts.googleapis.com/css?family=Abril+Fatface|Share+Tech+Mono|Bungee+Shade|Cinzel:400,700|Cute+Font|Faster+One|Monoton|Permanent+Marker|Quicksand:400,600,700|Special+Elite|Vibes&display=swap" rel="stylesheet">
		<link href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous" rel="stylesheet">
		<link href="./style.css" rel="stylesheet">
		<script src="./app.js"></script>
	</head>
	<body style="display:none;">
		<div id="front-center">
			<input type="text" name="" id="filter" autofocus autocomplete="off">
			<div class="footer">
				<span class="c">© 2019 x1n13y84issmd42</span>
				<span class="pipe"></span>
				<a href="https://github.com/x1n13y84issmd42/70015">GitHub</a>
				<span class="pipe"></span>
				<span class="c">With elitism in ♥</span>
			</div>
		</div>

		<div id="tools"></div>

		<script>
			let config = new LSConfig();
			let bench = new Workbench(config);

			function focus(id) {
				bench.focus(id);
			}

			function unfocus(id) {
				bench.unfocus(id);
				window.location.hash = '';
				filter.focus();
			}

			function offset(e) {
				let res = {
					left: e.offsetLeft,
					top: e.offsetTop,
				};

				let p = e.parentNode;

				while(p) {
					res.left += ~~p.offsetLeft;
					res.top += ~~p.offsetTop;

					p = p.parentNode;
				}

				return res;
			}

			function share(id, e) {
				console.log(`Sharing the #${id} tool!`);
				let tool = bench.get(id);
				tool.C.classList.add('bg');
				
				let value = `A shareable URL is expected here`;
				let dlgBGE = Component.NewElement('div', ['dialog-bg', 'out']);
				let shareC = Component.New('share', {title: `Share ${id}`, value: value});
				dlgBGE.appendChild(shareC);
				dlgBGE.onclick = (e) => {
					if (e.target === e.currentTarget) {
						document.body.removeChild(dlgBGE);
						tool.C.classList.remove('bg');
					}
				};

				document.body.appendChild(dlgBGE);
				
				setTimeout(() => {
					dlgBGE.classList.remove('out');
					dlgBGE.classList.add('in');
				}, 0);
			}
		</script>



<div id="components">
	<dialog data-purpose="social" _id="share" title="${title}">
		<section _id="link">
			<input type="text" value="${value}" />
			<undercontrols>
				<copy from="#link" handler="onclickCopyToClipboard(e)"></copy>
			</undercontrols>
		</section>
	</dialog>

	<!-- continues in toolshed.html -->


<!-- The <block> component structure - a group of controls usually built around an <in> input component. -->
<section _comp="block" id="{inst._id}"></section>

<script>
	XUI.register('block');
</script>



<!-- The <checkbox> component structure. -->
<label _comp="checkbox" for="{Σ(inst._id)}">
	<input type="checkbox" id="{Σ(inst._id)}" xui-as="in">
	<span>{inst.$||args.label}</span>
</label>

<script>
	XUI.register('checkbox', (elements, inst, args, ctx) => {
		(inst.checked != undefined) && (elements.in.checked = true);
	});
</script>



<!-- The <copy> component structure. -->
<a _comp="copy" class="copy" data-from="{inst.from}">
	<span>{inst.$||"Copy"}</span><i class="far fa-copy"></i>
</a>

<script>
	XUI.register('copy');
</script>



<!-- The <error> component structure - a general error reporting element under inputs. -->
<p _comp="error" class="error">
	<i class="fas fa-exclamation-circle"></i>
	<span>{inst.$||args.error||"&nbsp;"}</span>
</p>

<script>
	XUI.register("error");
</script>



<!-- The <in> component structure - a flexible input field. -->
<div _comp="in">
	<label for="{Σ(inst._id)}">{inst.label}</label>
	<input xui-if="inst.type==='text'" type="text" id="{Σ(inst._id)}" autofocus="" value="{inst.$||args.value}">
	<textarea xui-if="inst.type==='area'" name="{inst.name}" id="" cols="{inst.cols||30}" rows="{inst.rows||10}">{inst.$}</textarea>
</div>

<script>
	XUI.register('in');
</script>



<!-- The <kvpair> component structure - a key-value pair, values get copied to clipboard when clicked. -->
<div _comp="kvpair" class="kvpair kv">
	<span class="key">{inst.key||inst.k||args.k}</span>
	<span class="value" xui-as="v">{inst.value||inst.v||args.v||inst.$}</span>
</div>

<script>
	XUI.register('kvpair', (elements, inst, args, ctx) => {
		elements.v.onclick = args.onclick || onclickCopyToClipboard;
	});
</script>



<!-- The <kvsection> component structure. -->
<div _comp="kvsection" class="kvpair kvsection">
	<span class="key">{inst.$||args.label}</span>
</div>

<script>
	XUI.register('kvsection');
</script>



<!-- The <overcontrols> component structure. -->
<div _comp="overcontrols" class="overcontrols"></div>

<script>
	XUI.register("overcontrols");
</script>



<!-- The <radio> component structure. -->
<label _comp="radio" for="{Σ(inst._id)}">
	<input type="radio" name="{Σ(inst.name)}" id="{Σ(inst._id)}" xui-as="in">
	<span>{inst.$||args.label}</span>
</label>

<script>
	XUI.register('radio', (elements, inst, args, ctx) => {
		(inst.checked != undefined) && (elements.in.checked = true);
	});
</script>



<!-- The <reuse> component structure - a menu to transfer data pieces between tools. -->
<div _comp="reuse" class="menu switch">
	<span>{inst.title||"Reuse"}<i class="fas fa-recycle"></i></span>
	<div xui-root></div>
</div>

<script>
	XUI.register('reuse', (elements, inst, args, ctx) => {
		//	Building the menu items.
		//	Things like
		//		<hasher input="json">Hash it</hasher>
		//	become
		//		<a data-to="hasher" data-input="json">Hash it</a>
		for (let instChildE of elements.$inst.children) {
			let aE = document.createElement('a');
			aE.dataset.to = instChildE.nodeName.toLowerCase();

			for (let instChildEAI = 0; instChildEAI < instChildE.attributes.length; instChildEAI++) {
				let instChildEA = instChildE.attributes[instChildEAI];
				aE.dataset[instChildEA.nodeName] = instChildEA.nodeValue
			}
			
			aE.innerText = instChildE.innerText;

			XUI.enrich(aE, inst, args, {}, ctx);

			aE.onclick = (e) => {
				let aSwitchData = {};
				for (let eDN in e.target.dataset) {
					aSwitchData[eDN] = e.target.dataset[eDN];

					//	May be a reference by id
					if (window[aSwitchData[eDN]]) {
						aSwitchData[eDN] = window[aSwitchData[eDN]].value;
					}
				}

				bench.switch(aE.dataset.to, aSwitchData);
			}

			elements.$root.appendChild(aE);
		}
	}, false);
</script>



<!-- The <tool> component structure. -->
<div _comp="tool" class="tool focused" id="{inst._id}" data-tag="{inst.tag}">
	<div class="preview">
		<h1>{inst.name}</h1>
	</div>
	<div class="controls smaller" xui-root></div>
</div>

<script>
	XUI.register('tool', (elements, inst, comp, ctx) => {
		ctx.set("toolID", elements.$comp.id);
	});
</script>



<!-- The <undercontrols> component structure. -->
<div _comp="undercontrols" class="undercontrols"></div>

<script>
	XUI.register("undercontrols", (elements, inst, args, ctx) => {
		if (inst.error) {
			elements.$comp.appendChild(XUIC.error())
		}
	});
</script>



</div>
<!-- #components, opened in components.html -->

<div id="toolshed">
<!-- continues in epilogue.html -->


		</div>
		<!-- #toolshed, opened in toolshed.html -->

		<div id="uiStash"></div>

		<tool _id="unixtime" tag="unixtime" name="Unixtime">
			<block _id="ts">
				<overcontrols>
					<radio name="daname" _id="daidScuko" value="--">Scuko</radio>
					<radio name="daname" _id="daidBljad" value="--" checked>Bljad</radio>
					<radio name="daname" _id="daidNahuy" value="--">Nahuy</radio>
					<checkbox _id="checkie-norm" value="--">Checkie 1</checkbox>
					<checkbox _id="checkie-yeet" value="--" checked>Checkie 2</checkbox>
				</overcontrols>
				<in type="text" autofocus label="Unixtime (also {args.theValue})"></in>
				<undercontrols error="true">
					<copy from="{Δ('ts')}"></copy>
					<reuse>
						<jsonyaml json="{Δ('ts')}">Convert it to YAML</jsonyaml>
						<base64 ascii="{Δ('ts')}">Base64-encode it</base64>
					</reuse>
				</undercontrols>

				<kvsection>Valyos</kvsection>
				<kvpair key="F00">B4RRR! (from $)</kvpair>
				<kvpair key="F00" value="B4RRR! (from value)"></kvpair>

				<kvsection>Moar</kvsection>
				<kvpair k="F00" v="B4RRR! (from v)"></kvpair>
				<kvpair k="F00" v="B4RRR! (from v) with {args.theValue}"></kvpair>
			</block>
		</tool>

		<script>
			let toolInst = document.querySelector('[_id=unixtime]')
			let toolComp = XUIC.tool(toolInst, {k: "A key", theValue: "T3H VALYOOO"});
			document.body.appendChild(toolComp);

			/**
			 * Temporarily applies a class to an element. The class is removed after the specified amount of time passes.
			 * @param {HTMLElement} e An element to style.
			 * @param {string} className A class name to apply temporarily.
			 * @param {number} time A time period the class should be removed after.
			 */
			function tmpStyle(e, className, time) {
				e.classList.add(className);
				setTimeout(() => {
					e.classList.remove(className);
				}, time);
			}

			function copiedFloater(x, y) {
				let fltr = document.createElement('div');
				fltr.classList.add("floater");
				fltr.style.left = (x - 45) + "px";
				fltr.style.top = (y - 35) + "px";
				fltr.innerHTML = 'Copied.';
				document.body.appendChild(fltr);

				setTimeout(() => {
					fltr.classList.add("vanishing");
				}, 0);

				setTimeout(() => {
					document.body.removeChild(fltr);
				}, 1000);
			}

			function onclickCopyToClipboard(e) {
				let from = e.currentTarget;

				//	Looking for a disabled parent.
				let pn = from.parentNode;
				while (pn) {
					if (pn.classList && pn.classList.contains('disabled')) {
						return;
					}
					pn = pn.parentNode;
				}

				if (from.dataset.value) {
					Clipboard.copy(from.dataset.value);
					tmpStyle(from, 'copied', 200);
					copiedFloater(e.pageX, e.pageY);
					return;
				}
				
				if (from.dataset.from) {
					from = document.getElementById(from.dataset.from);
				}
				
				if (from) {	
					switch (from.tagName) {
						case "INPUT":
						case "TEXTAREA":
							Clipboard.copy(from.value);
							break;
							
						default:
							Clipboard.copy(from.innerHTML);
							break;
					}

					tmpStyle(from, 'copied', 200);
					copiedFloater(e.pageX, e.pageY);
				}
			}

			document.body.onload = () => {
				// let dialogE = Component.New('share', {
				// 	title: 'Share',
				// 	value: `${window.location.pathname}#yolo2020`
				// });
				// document.body.appendChild(dialogE);

				let filter = document.getElementById("filter");
				filter.oninput = () => {
					bench.filter(filter.value);
				}
				
				filter.onkeydown = (e) => {
					if (e.key == 'Enter') {
						//	Focusing the only matched tool.
						let matched = document.querySelectorAll(".matched");
						if (matched.length == 1) {
							focus(matched[0].id);
							e.preventDefault();
							e.cancelBubble = true;
						}
					} else if (e.key == 'Escape') {
						//	Clearing the filtering.
						filter.value = "";
						bench.filter("");
					}
				}

				//	Copy buttons.
				document.querySelectorAll('.copy').forEach((v, k, p) => {v.onclick = onclickCopyToClipboard});

				//	Autofocusing tools upon page load.
				if (window.location.hash) {
					bench.focus(window.location.hash.substr(1));
				}

				bench.render();
			}
		</script>
	</body>
</html>


