<html>
	<head>
		<link href="https://fonts.googleapis.com/css?family=Abril+Fatface|Share+Tech+Mono|Bungee+Shade|Cinzel:400,700|Cute+Font|Faster+One|Monoton|Permanent+Marker|Quicksand:400,600,700|Special+Elite|Vibes&display=swap" rel="stylesheet">
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
		<link href="./style.css" rel="stylesheet">
		<link href="./tools-list.css" rel="stylesheet">
		<script src="./tools-list.js"></script>
		<script>
			let tools = new Tools(400, 300, document.body)

			function focus(id) {
				let el = document.getElementById(id);
				if (el) {
					el.classList.replace('unfocused', 'focused');
					el.focus();
					let af = el.querySelector("[autofocus]")
					if (af) {
						af.focus();
					}
				}

				document.body.onkeydown = (e) => {
					if (e.key == 'Escape') {
						unfocus(id);
					}
				}
			}

			function unfocus(id) {
				tools.unfocus(id);
				filter.focus();
			}

			function Tool(id, props) {
				let E = this.E = document.getElementById(id);

				for (let p in props) {
					this[p] = props[p](this.E);
				}

				E.querySelector('.preview').onclick = () => {
					focus(id);
				}

				let ctrls = E.querySelector(".controls");
				let eClose = document.createElement("a");
				eClose.innerHTML = "<span>CLOSE</span><i>&#x1f7a8</i>";
				eClose.classList.add("close");
				eClose.onclick = (e) => {unfocus(id); e.preventDefault();e.cancelBubble=true;}
				ctrls.append(eClose);
			}

			Tool.prototype.$ = function(s) {
				return this.E.querySelectorAll(s);
			}

			Tool.prototype.T = function(s, v) {
				this.tplNodes(this.$(s));				
			}

			Tool.prototype.tplNodes = function(nodes, v) {
				for (e of nodes) {
					switch (e.tagName) {
						case "INPUT":
						case "TEXTAREA":
							e.value = v;
						break;

						default:
							e.innerHTML = v;
						break;
					}
				}
			}

			Tool.prototype.Component = function(s) {
				let args = Array.prototype.slice.apply(arguments);
				let compID = args.shift();
				let compE = this.$(`.components .${compID}`)[0];

				if (compE) {
					compE = compE.cloneNode(true);

					for (let aI in args) {
						let nodes = compE.querySelectorAll(`[data-arg="${aI}"]`);
						this.tplNodes(nodes, args[aI])
					}

					return compE;
				}
			}

		</script>
	</head>
	<body>
		<div id="front-center">
			<input type="text" name="" id="filter" autofocus>
			<div class="footer">
				<span class="c">© 2019 x1n13y84issmd42</span>
				<span class="pipe"></span>
				<a href="https://github.com/x1n13y84issmd42/bashttpd">GitHub</a>
				<span class="pipe"></span>
				<span class="c">With elitism in ♥</span>
			</div>
		</div>

		<div id="tools"><div class="tool unfocused col2" id="base64" data-tag="base64">
	<div class="preview"><h1>Base64</h1></div>
	<div class="controls">
		<label for="base64Input">Base64-encoded string</label>
		<textarea class="base64Input" id="base64Input" autofocus tabindex="21"></textarea>
		<label for="asciiInput">ASCII string</label>
		<textarea class="asciiInput" tabindex="22" onFocus="this.tabIndex=20;" onBlur="this.tabIndex=22;"></textarea>
	</div>

	<script>
		let base64 = new Tool("base64", {
			inBase64: (e) => e.querySelectorAll('.base64Input')[0],
			inAscii: (e) => e.querySelectorAll('.asciiInput')[0],
		});

		base64.decode = function() {
			base64.inAscii.value = atob(base64.inBase64.value);
		};
		
		base64.encode = function() {
			base64.inBase64.value = btoa(base64.inAscii.value);
		};

		base64.inBase64.oninput = base64.inBase64.onchange = base64.decode;
		base64.inAscii.oninput = base64.inAscii.onchange = base64.encode;
	</script>
</div><div class="tool unfocused col3" id="json" data-tag="json format">
	<div class="preview"><h1>JSON Format</h1></div>
	<div class="controls">
		<label for="json-jsonInput">JSON input</label>
		<textarea class="jsonInput" id="json-jsonInput" autofocus spellcheck="false"></textarea>
		<p class="jsonErr error"></p>
		
		<label for="json-1liner">One-liner JSON</label>
		<div class="subcontrols" data-for="json-1liner">
			<label for="json-1liner-escape">
				<input type="checkbox" name="json-1liner-escape" id="json-1liner-escape">
				Escape the quotes
			</label>
			<a class="copy"><span>COPY</span><i class="far fa-copy"></i></a>
		</div>
		<input type="text" name="json-1liner" id="json-1liner" spellcheck="false" disabled>
		
		<label for="json-pretty">Pretty JSON</label>
		<div class="subcontrols" data-for="json-pretty">
			<label for="">Indent with</label>
			<label for="json-pretty-indent-tabs"><input type="radio" name="json-pretty-indent" id="json-pretty-indent-tabs" value="	" checked>tabs</label>
			<label for="json-pretty-indent-2spaces"><input type="radio" name="json-pretty-indent" id="json-pretty-indent-2spaces" value="  ">2 spaces</label>
			<label for="json-pretty-indent-4spaces"><input type="radio" name="json-pretty-indent" id="json-pretty-indent-4spaces" value="    ">4 spaces</label>
			<a class="copy"><span>COPY</span><i class="far fa-copy"></i></a>
		</div>
		<textarea id="json-pretty" rows="8" spellcheck="false" disabled></textarea>
	</div>
	
	<script>
		let json = new Tool("json", {
			inJSON: (e) => e.querySelectorAll('.jsonInput')[0],
			outPretty: (e) => e.querySelectorAll('#json-pretty')[0],
			out1liner: (e) => e.querySelectorAll('#json-1liner')[0],
			indentRadios: (e) => e.querySelectorAll('input[name=json-pretty-indent]'),
			err: (e) => e.querySelectorAll('.jsonErr')[0],
		});

		json.prettyPrint = function() {
			let v;
			try {
				v = JSON.parse(json.inJSON.value);
			} catch (e) {
				json.err.innerHTML = e.message
			}

			if (v) {
				let indent = "\t";
				for (let r of json.indentRadios) {
					if (r.checked) {
						indent = r.value;
					}
				}

				json.outPretty.value = JSON.stringify(v, null, indent);
			}
		};

		json.oneliner = function() {
			let v;
			try {
				v = JSON.parse(json.inJSON.value);
			} catch (e) {
				json.err.innerHTML = e.message
			}

			if (v) {
				json.out1liner.value = JSON.stringify(v);
			}
		}

		json.update = () => {
			json.prettyPrint();
			json.oneliner();
		}

		for (let r of json.indentRadios) {
			r.onchange = json.update;
		}

		json.inJSON.oninput = json.inJSON.onchange = json.update;
	</script>
</div><div class="tool unfocused col3" id="unixtime" data-tag="unixtime">
	<div class="preview"><h1>Unixtime</h1></div>
	<div class="controls smaller">
		<label for="unixtime-inTimestamp">Unixtime</label>
		<input type="text" class="inTimestamp" id="unixtime-inTimestamp" autofocus>
		<div class="left">
			<div class="typographyDate">
				<p class="l1">&nbsp;</p>
			</div>
		</div>

		<div class="right">
			<p class="outDate"></p>
		</div>
	</div>

	<script>
		let unixtime = new Tool("unixtime", {
			inTS: (e) => e.querySelectorAll('.inTimestamp')[0],
			outDate: (e) => e.querySelectorAll('.outDate')[0],
		});

		unixtime.convert = function() {
			let d = new Date();
			d.setTime(unixtime.inTS.value + "000")
			unixtime.outDate.innerHTML = d.toString();
			typographyDate(d);
		};

		function typographyDate(d) {
			let timezone = undefined;
			let eTZT = document.createElement("p");
			let opts = {
				timezone,
				weekday: "long",
				month: "long",
				year: "numeric",
				day: "numeric",
				hour: "numeric",
				minute: "numeric",
				second: "numeric",
			};
			let locale = "en-US";
			let weekday = d.toLocaleDateString(locale, {timezone, weekday: "long"});
			let weekdayClass = "l" + weekday.length;
			let weekdayE = document.createElement("p");
			let month = d.toLocaleDateString(locale, {timezone, month: "long", day: "numeric"});
			let monthClass = "l" + month.length;
			let monthE = document.createElement("p");
			let year = d.toLocaleDateString(locale, {timezone, year: "numeric"});
			let yearClass = "l" + year.length;
			let yearE = document.createElement("p");
			let time = d.toLocaleDateString(locale, {timezone, hour: "numeric", minute: "numeric", second: "numeric"});
			let timeClass = "l" + time.length;
			let timeE = document.createElement("p");

			weekdayE.classList.add("weekday", weekdayClass);
			weekdayE.innerHTML = weekday;
			monthE.classList.add("month", monthClass);
			monthE.innerHTML = month;
			yearE.classList.add("year", yearClass);
			yearE.innerHTML = year;
			timeE.classList.add("time", timeClass);
			timeE.innerHTML = time;

			let tdE = unixtime.$(".typographyDate")[0];

			while (tdE.firstChild)
				tdE.removeChild(tdE.firstChild)

			tdE.appendChild(weekdayE);
			tdE.appendChild(monthE);
			tdE.appendChild(yearE);
			tdE.appendChild(timeE);
		}
		
		unixtime.inTS.oninput = unixtime.inTS.onchange = unixtime.convert;
		</script>
</div><div class="tool unfocused col1" id="urldecode" data-tag="url encode decode">
	<div class="preview"><h1>URL Transcode</h1></div>
	<div class="controls smaller">
		<label for="urldecode-encinput">URL-encoded string</label>
		<input type="text" class="encinput" id="urldecode-encinput" autofocus tabindex="11">
		<label for="urldecode-encinput">ASCII string</label>
		<input type="text" class="decinput" id="urldecode-decinput" tabindex="12" onFocus="this.tabIndex=10;" onBlur="this.tabIndex=12;">
	</div>

	<script>
		let urldecoder = new Tool("urldecode", {
			encoded: (e) => e.querySelectorAll('.encinput')[0],
			decoded: (e) => e.querySelectorAll('.decinput')[0],
		});

		urldecoder.decode = function() {
			urldecoder.decoded.value = decodeURIComponent(urldecoder.encoded.value);
		};
		
		urldecoder.encode = function() {
			urldecoder.encoded.value = encodeURIComponent(urldecoder.decoded.value);
		};

		urldecoder.encoded.oninput = urldecoder.encoded.onchange = urldecoder.decode;
		urldecoder.decoded.oninput = urldecoder.decoded.onchange = urldecoder.encode;
	</script>
</div><div class="tool unfocused" id="urlparse" data-tag="urlparse">
	<div class="preview"><h1>URL Parser</h1></div>
	<div class="controls smaller">
		<label for="urlparse-url">URL</label>
		<input type="text" name="urlparse-url" id="urlparse-url" spellcheck="false" autofocus>

		<div class="fields">
		</div>
	</div>

	<script>
		let urlparse = new Tool("urlparse", {
			URL: () => document.getElementById("urlparse-url")
		})

		urlparse.URL.onchange = urlparse.URL.oninput = () => {
			let fields = urlparse.$(".fields")[0];
			while (fields.firstChild)
				fields.removeChild(fields.firstChild);

			let url = new URL(urlparse.URL.value);
			
			if (url.protocol) {
				fields.appendChild(urlparse.Component("urlprop", "Protocol", url.protocol));
			}

			if (url.hostname) {
				fields.appendChild(urlparse.Component("urlprop", "Domain", url.hostname));
			}

			if (url.username) {
				fields.appendChild(urlparse.Component("urlprop", "Username", url.username));
			}

			if (url.password) {
				fields.appendChild(urlparse.Component("urlprop", "Password", url.password));
			}

			if (url.path) {
				fields.appendChild(urlparse.Component("urlprop", "Path", url.path));
			} else if (url.pathname) {
				fields.appendChild(urlparse.Component("urlprop", "Path", url.pathname));
			}

			if (url.port) {
				fields.appendChild(urlparse.Component("urlprop", "Port", url.port));
			}

			if (url.hash) {
				fields.appendChild(urlparse.Component("urlprop", "Hash", url.hash));
			}

			/* if (url.search) {
				fields.appendChild(urlparse.Component("urlprop", "Query string", url.search));
			} */
			
			if (url.searchParams) {
				fields.appendChild(urlparse.Component("urlprop-section", "Query parameters"));
				for (let e of url.searchParams.entries()) {
					fields.appendChild(urlparse.Component("urlprop-sub", e[0], e[1]));
				}
			}
		};
	</script>

	<div class="components">
		<div class="urlprop">
			<span class="label" data-arg="0"></span>
			<span class="value" data-arg="1"></span>
		</div>
		
		<div class="urlprop urlprop-section">
			<span class="label" data-arg="0"></span>
		</div>
		
		<div class="urlprop urlprop-sub">
			<span class="label" data-arg="0"></span>
			<span class="value" data-arg="1"></span>
		</div>
	</div>
</div>		</div>

		<script>
			document.body.onload = () => {
				tools.add('urldecode')
				tools.add('unixtime')
				tools.add('base64')
				tools.add('json')
				tools.add('urlparse')
				
				let filter = document.getElementById("filter");
				filter.onchange = filter.oninput = () => {
					tools.filter(filter.value);
				}
				
				filter.onkeydown = (e) => {
					if (e.key == 'Enter') {
						let matched = document.querySelectorAll(".matched");
						if (matched.length == 1) {
							focus(matched[0].id);
							e.preventDefault();
							e.cancelBubble = true;
						}
					} else if (e.key == 'Escape') {
						filter.value = "";
						tools.filter("");
					}
				}
			}
		</script>
	</body>
</html>