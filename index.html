
<html>
	<head>
		<link href="https://fonts.googleapis.com/css?family=Abril+Fatface|Share+Tech+Mono|Bungee+Shade|Cinzel:400,700|Cute+Font|Faster+One|Monoton|Permanent+Marker|Quicksand:400,600,700|Special+Elite|Vibes&display=swap" rel="stylesheet">
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
		<link href="./style.css" rel="stylesheet">
		<script src="./app.js"></script>
		<script>
			let tools = new Tools()

			function focus(id) {
				let el = document.getElementById(id);
				if (el) {
					el.classList.replace('unfocused', 'focused');
					el.focus();
					let af = el.querySelector("[autofocus]")
					if (af) {
						af.focus();
					}
				}

				document.body.onkeydown = (e) => {
					if (e.key == 'Escape') {
						unfocus(id);
					}
				}
			}

			function unfocus(id) {
				tools.unfocus(id);
				filter.focus();
			}
		</script>
	</head>
	<body>
		<div id="front-center">
			<input type="text" name="" id="filter" autofocus>
			<div class="footer">
				<span class="c">© 2019 x1n13y84issmd42</span>
				<span class="pipe"></span>
				<a href="https://github.com/x1n13y84issmd42/70015">GitHub</a>
				<span class="pipe"></span>
				<span class="c">With elitism in ♥</span>
			</div>
		</div>

		<div id="tools"><div class="tool unfocused col2" id="base64" data-tag="base64">
	<div class="preview"><h1>Base64</h1></div>
	<div class="controls">
		<label for="base64Input">Base64-encoded string</label>
		<textarea class="base64Input" id="base64Input" autofocus tabindex="21"></textarea>
		<div class="bothways">It works ⇃both↾ ways.</div>
		<label for="asciiInput">ASCII string</label>
		<textarea class="asciiInput" tabindex="22" onFocus="this.tabIndex=20;" onBlur="this.tabIndex=22;"></textarea>
	</div>

	<script>
		class TBase64 extends Tool {
			constructor(id) {
				super(id);

				this.inBase64 = this.E.querySelectorAll('.base64Input')[0];
				this.inAscii = this.E.querySelectorAll('.asciiInput')[0];

				this.inBase64.oninput = this.inBase64.onchange = () => this.decode();
				this.inAscii.oninput = this.inAscii.onchange = () => this.encode();
			}

			decode() {
				this.inAscii.value = atob(this.inBase64.value);
			};
			
			encode() {
				this.inBase64.value = btoa(this.inAscii.value);
			};
		}

		let base64 = new TBase64("base64");
	</script>
</div><div class="tool unfocused col3" id="json" data-tag="json format">
	<div class="preview"><h1>JSON Format</h1></div>
	<div class="controls">
		<label for="json-jsonInput">JSON input</label>
		<textarea class="jsonInput" id="json-jsonInput" autofocus spellcheck="false" style="margin-bottom:0.5em;"></textarea>
		<p class="jsonErr error"><i class="fas fa-exclamation-circle"></i><span>&nbsp;</span></p>
		
		<label for="json-1liner">One-liner JSON</label>
		<div class="subcontrols" data-for="json-1liner">
			<label for="json-1liner-quote-identifiers">
				<input type="checkbox" name="json-1liner-quote-identifiers" id="json-1liner-quote-identifiers">
				Quote names
			</label>
			<label for="json-1liner-escape-quotes">
				<input type="checkbox" name="json-1liner-escape-quotes" id="json-1liner-escape-quotes">
				Escape the quotes
			</label>
			<a class="copy"><span>COPY</span><i class="far fa-copy"></i></a>
		</div>
		<input type="text" name="json-1liner" id="json-1liner" spellcheck="false" disabled>
		
		<label for="json-pretty">Pretty JSON</label>
		<div class="subcontrols" data-for="json-pretty">
			<label for="">Indent with</label>
			<label for="json-pretty-indent-tabs"><input type="radio" name="json-pretty-indent" id="json-pretty-indent-tabs" value="	" checked>tabs</label>
			<label for="json-pretty-indent-4spaces"><input type="radio" name="json-pretty-indent" id="json-pretty-indent-4spaces" value="    ">4 spaces</label>
			<label for="json-pretty-indent-2spaces"><input type="radio" name="json-pretty-indent" id="json-pretty-indent-2spaces" value="  ">2 spaces</label>
			<a class="copy"><span>COPY</span><i class="far fa-copy"></i></a>
		</div>
		<textarea id="json-pretty" rows="8" spellcheck="false" disabled></textarea>
	</div>
	
	<script>
		class TJSON extends Tool {
			constructor(id) {
				super(id);

				this.inJSON = this.E.querySelectorAll('.jsonInput')[0];
				this.outPretty = this.E.querySelectorAll('#json-pretty')[0];
				this.out1liner = this.E.querySelectorAll('#json-1liner')[0];
				this.indentRadios = this.E.querySelectorAll('input[name=json-pretty-indent]');
				this.quoteCheck = document.getElementById('json-1liner-quote-identifiers');
				this.escapeQuotesCheck = document.getElementById('json-1liner-escape-quotes');

				let update = () => {
					this.update();
				}
				
				let switches = this.E.querySelectorAll('input[type=radio],input[type=checkbox]');
				for (let s of switches) {
					s.onchange = update;
				}

				this.inJSON.oninput = this.inJSON.onchange = update;
			}

			update() {
				try {
					let v = JSON.parse(this.inJSON.value);
					this.Error('jsonErr', '');
					this.prettyPrint(v);
					this.oneliner(v);
				} catch (e) {
					this.Error('jsonErr', e.message);
				}
			}

			prettyPrint(v) {
				if (v) {
					let indent = "\t";
					for (let r of this.indentRadios) {
						if (r.checked) {
							indent = r.value;
						}
					}

					this.outPretty.value = JSON.stringify(v, null, indent);
				}
			}

			oneliner(v) {
				if (v) {
					this.out1liner.value = JSON1Liner(undefined, v, this.quoteCheck.checked, this.escapeQuotesCheck.checked);
				}
			}
		}

		function JSON1Liner(name, v, quoteNames, escapeQuotes) {
			let quote = (s) => escapeQuotes ? `\\"${s}\\"` : `"${s}"`;
			let namePrefix = '';
			name && (namePrefix = name) && quoteNames && (namePrefix = quote(namePrefix));
			namePrefix && (namePrefix += ':');

			switch (typeof v) {
				case 'string':
					return namePrefix + quote(v);

				case 'number':
					return namePrefix + v.toString();

				case 'object':
					if (v instanceof Array) {
						return `${namePrefix}[` + v.map((vv) => JSON1Liner(undefined, vv, quoteNames, escapeQuotes)).join(',') + "]";
					} else {
						return `${namePrefix}{` + Object.keys(v).map((vk) => JSON1Liner(vk, v[vk], quoteNames, escapeQuotes)) + "}";
					}
					break
			}
		}

		let json = new TJSON('json');
	</script>
</div><div class="tool unfocused col3" id="unixtime" data-tag="unixtime">
	<div class="preview"><h1>Unixtime</h1></div>
	<div class="controls smaller">
		<label for="unixtime-inTimestamp">Unixtime</label>
		<input type="text" class="inTimestamp" id="unixtime-inTimestamp" autofocus>
		<div class="left">
			<div class="typographyDate">
				<p class="l1">&nbsp;</p>
			</div>
		</div>

		<div class="right">
			<p class="outDate"></p>
		</div>
	</div>

	<script>
		class TUnixtime extends Tool {
			constructor(id) {
				super(id);

				this.inTS = this.E.querySelectorAll('.inTimestamp')[0];
				this.outDate = this.E.querySelectorAll('.outDate')[0];

				this.inTS.oninput = this.inTS.onchange = () => this.convert();
			}

			convert() {
				let d = new Date();
				d.setTime(this.inTS.value + "000")
				this.outDate.innerHTML = d.toString();
				this.typographyDate(d);
			}

			typographyDate(d) {
				let timezone = undefined;
				let eTZT = document.createElement("p");
				let opts = {
					timezone,
					weekday: "long",
					month: "long",
					year: "numeric",
					day: "numeric",
					hour: "numeric",
					minute: "numeric",
					second: "numeric",
				};
				let locale = "en-US";
				let weekday = d.toLocaleDateString(locale, {timezone, weekday: "long"});
				let weekdayClass = "l" + weekday.length;
				let weekdayE = document.createElement("p");
				let month = d.toLocaleDateString(locale, {timezone, month: "long", day: "numeric"});
				let monthClass = "l" + month.length;
				let monthE = document.createElement("p");
				let year = d.toLocaleDateString(locale, {timezone, year: "numeric"});
				let yearClass = "l" + year.length;
				let yearE = document.createElement("p");
				let time = d.toLocaleDateString(locale, {timezone, hour: "numeric", minute: "numeric", second: "numeric"});
				let timeClass = "l" + time.length;
				let timeE = document.createElement("p");

				weekdayE.classList.add("weekday", weekdayClass);
				weekdayE.innerHTML = weekday;
				monthE.classList.add("month", monthClass);
				monthE.innerHTML = month;
				yearE.classList.add("year", yearClass);
				yearE.innerHTML = year;
				timeE.classList.add("time", timeClass);
				timeE.innerHTML = time;

				let tdE = this.$(".typographyDate")[0];

				while (tdE.firstChild)
					tdE.removeChild(tdE.firstChild)

				tdE.appendChild(weekdayE);
				tdE.appendChild(monthE);
				tdE.appendChild(yearE);
				tdE.appendChild(timeE);
			}
		}

		let unixtime = new TUnixtime("unixtime");

	</script>
</div><div class="tool unfocused col1" id="urldecode" data-tag="url encode decode">
	<div class="preview"><h1>URL Transcode</h1></div>
	<div class="controls smaller">
		<label for="urldecode-encinput">URL-encoded string</label>
		<input type="text" class="encinput" id="urldecode-encinput" autofocus tabindex="11">
		<div class="bothways">It works ⇃both↾ ways.</div>
		<label for="urldecode-encinput">ASCII string</label>
		<input type="text" class="decinput" id="urldecode-decinput" tabindex="12" onFocus="this.tabIndex=10;" onBlur="this.tabIndex=12;">
	</div>

	<script>
		class TURLTranscoder extends Tool {
			constructor(id) {
				super(id)

				this.encoded = this.E.querySelectorAll('.encinput')[0];
				this.decoded = this.E.querySelectorAll('.decinput')[0];
				this.encoded.oninput = this.encoded.onchange = () => this.decode();
				this.decoded.oninput = this.decoded.onchange = () => this.encode();
			}
	
			decode() {
				this.decoded.value = decodeURIComponent(this.encoded.value);
			};
			
			encode() {
				this.encoded.value = encodeURIComponent(this.decoded.value);
			};

		}

		let urldecoder = new TURLTranscoder("urldecode");

	</script>
</div><div class="tool unfocused" id="urlparse" data-tag="urlparse">
	<div class="preview"><h1>URL Parser</h1></div>
	<div class="controls smaller">
		<label for="urlparse-url">URL</label>
		<input type="text" name="urlparse-url" id="urlparse-url" spellcheck="false" autofocus>

		<div class="fields">
		</div>
	</div>

	<script>
		class TURLParser extends Tool {
			constructor(id) {
				super(id);
				this.URL = document.getElementById("urlparse-url");

				this.URL.onchange = this.URL.oninput = () => {
					let fields = this.$(".fields")[0];
					while (fields.firstChild)
						fields.removeChild(fields.firstChild);

					let url = new URL(this.URL.value);
					
					if (url.protocol) {
						fields.appendChild(this.Component("urlprop", "Protocol", url.protocol));
					}

					if (url.hostname) {
						fields.appendChild(this.Component("urlprop", "Domain", url.hostname));
					}

					if (url.username) {
						fields.appendChild(this.Component("urlprop", "Username", url.username));
					}

					if (url.password) {
						fields.appendChild(this.Component("urlprop", "Password", url.password));
					}

					if (url.path) {
						fields.appendChild(this.Component("urlprop", "Path", url.path));
					} else if (url.pathname) {
						fields.appendChild(this.Component("urlprop", "Path", url.pathname));
					}

					if (url.port) {
						fields.appendChild(this.Component("urlprop", "Port", url.port));
					}

					if (url.hash) {
						fields.appendChild(this.Component("urlprop", "Hash", url.hash));
					}

					/* if (url.search) {
						fields.appendChild(this.Component("urlprop", "Query string", url.search));
					} */
					
					if (url.searchParams) {
						fields.appendChild(this.Component("urlprop-section", "Query"));
						for (let e of url.searchParams.entries()) {
							fields.appendChild(this.Component("urlprop-sub", e[0], e[1]));
						}
					}
				};
			}
		}

		let urlparse = new TURLParser("urlparse");
		
	</script>

	<div class="components">
		<div class="urlprop">
			<span class="label" data-arg="0"></span>
			<span class="value" data-arg="1"></span>
		</div>
		
		<div class="urlprop urlprop-section">
			<span class="label" data-arg="0"></span>
			<span class="value">&nbsp;</span>
		</div>
		
		<div class="urlprop urlprop-sub">
			<span class="label" data-arg="0"></span>
			<span class="value" data-arg="1"></span>
		</div>
	</div>
</div>		</div>

		<script>
			document.body.onload = () => {
				tools.add('urldecode')
				tools.add('unixtime')
				tools.add('base64')
				tools.add('json')
				tools.add('urlparse')
				
				let filter = document.getElementById("filter");
				filter.onchange = filter.oninput = () => {
					tools.filter(filter.value);
				}
				
				filter.onkeydown = (e) => {
					if (e.key == 'Enter') {
						let matched = document.querySelectorAll(".matched");
						if (matched.length == 1) {
							focus(matched[0].id);
							e.preventDefault();
							e.cancelBubble = true;
						}
					} else if (e.key == 'Escape') {
						filter.value = "";
						tools.filter("");
					}
				}
			}
		</script>
	</body>
</html>