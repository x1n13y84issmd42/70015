<div class="tool unfocused col3" id="json" data-tag="json format">
	<div class="preview"><h1>JSON Format</h1></div>
	<div class="controls">
		<label for="json-jsonInput">JSON input</label>
		<textarea class="jsonInput" id="json-jsonInput" autofocus spellcheck="false" style="margin-bottom:0.5em;"></textarea>
		<p class="jsonErr error"><i class="fas fa-exclamation-circle"></i><span>&nbsp;</span></p>
		
		<label for="json-1liner">One-liner JSON</label>
		<div class="subcontrols" data-for="json-1liner">
			<label for="json-1liner-quote-identifiers">
				<input type="checkbox" name="json-1liner-quote-identifiers" id="json-1liner-quote-identifiers">
				Quote names
			</label>
			<label for="json-1liner-escape-quotes">
				<input type="checkbox" name="json-1liner-escape-quotes" id="json-1liner-escape-quotes">
				Escape the quotes
			</label>
			<a class="copy" data-from="json-1liner"><span>COPY</span><i class="far fa-copy"></i></a>
		</div>
		<input type="text" name="json-1liner" id="json-1liner" spellcheck="false" disabled>
		
		<label for="json-pretty">Pretty JSON</label>
		<div class="subcontrols" data-for="json-pretty">
			<label for="">Indent with</label>
			<label for="json-pretty-indent-tabs"><input type="radio" name="json-pretty-indent" id="json-pretty-indent-tabs" value="	" checked>tabs</label>
			<label for="json-pretty-indent-4spaces"><input type="radio" name="json-pretty-indent" id="json-pretty-indent-4spaces" value="    ">4 spaces</label>
			<label for="json-pretty-indent-2spaces"><input type="radio" name="json-pretty-indent" id="json-pretty-indent-2spaces" value="  ">2 spaces</label>
			<a class="copy" data-from="json-pretty"><span>COPY</span><i class="far fa-copy"></i></a>
		</div>
		<textarea id="json-pretty" rows="8" spellcheck="false" disabled></textarea>
	</div>
	
	<script>
		class TJSON extends Tool {
			constructor(id) {
				super(id);

				this.inJSON = this.$('.jsonInput')[0];
				this.outPretty = this.$('#json-pretty')[0];
				this.out1liner = this.$('#json-1liner')[0];
				this.indentRadios = this.$('input[name=json-pretty-indent]');
				this.quoteCheck = document.getElementById('json-1liner-quote-identifiers');
				this.escapeQuotesCheck = document.getElementById('json-1liner-escape-quotes');

				let update = () => {
					this.update();
				}
				
				let switches = this.$('input[type=radio],input[type=checkbox]');
				for (let s of switches) {
					s.onchange = update;
				}

				this.inJSON.oninput = update;
			}

			update() {
				try {
					let v = JSON.parse(this.inJSON.value);
					this.Error('jsonErr', '');
					this.prettyPrint(v);
					this.oneliner(v);
				} catch (e) {
					this.Error('jsonErr', e.message);
					this.outPretty.value = this.out1liner.value = '¯\\_(ツ)_/¯';
				}
			}

			prettyPrint(v) {
				if (v) {
					let indent = "\t";
					for (let r of this.indentRadios) {
						if (r.checked) {
							indent = r.value;
						}
					}

					this.outPretty.value = JSON.stringify(v, null, indent);
				}
			}

			oneliner(v) {
				if (v) {
					this.out1liner.value = JSON1Liner(undefined, v, this.quoteCheck.checked, this.escapeQuotesCheck.checked);
				}
			}
		}

		function JSON1Liner(name, v, quoteNames, escapeQuotes) {
			let quote = (s) => escapeQuotes ? `\\"${s}\\"` : `"${s}"`;
			let namePrefix = '';
			name && (namePrefix = name) && quoteNames && (namePrefix = quote(namePrefix));
			namePrefix && (namePrefix += ':');

			switch (typeof v) {
				case 'string':
					return namePrefix + quote(v);

				case 'number':
					return namePrefix + v.toString();

				case 'object':
					if (v instanceof Array) {
						return `${namePrefix}[` + v.map((vv) => JSON1Liner(undefined, vv, quoteNames, escapeQuotes)).join(',') + "]";
					} else {
						return `${namePrefix}{` + Object.keys(v).map((vk) => JSON1Liner(vk, v[vk], quoteNames, escapeQuotes)) + "}";
					}
					break
			}
		}

		tools.add(new TJSON('json'));
	</script>

	<style>
		#json .jsonErr {
			margin-bottom: 2em;
		}

		#json .subcontrols {
			width: 1000px;
		}
	</style>
</div>