<div class="tool unfocused col3" id="json" data-tag="json format">
	<div class="preview"><h1>JSON Format</h1></div>
	<div class="controls">
		<label for="json-jsonInput">JSON input</label>
		<textarea class="jsonInput" id="json-jsonInput" autofocus spellcheck="false" style="margin-bottom:0.5em;"></textarea>
		<p class="jsonErr error"><i class="fas fa-exclamation-circle"></i><span>&nbsp;</span></p>
		
		<label for="json-1liner">One-liner JSON</label>
		<div class="subcontrols" data-for="json-1liner">
			<label for="json-1liner-quote-identifiers">
				<input type="checkbox" name="json-1liner-quote-identifiers" id="json-1liner-quote-identifiers">
				Quote names
			</label>
			<label for="json-1liner-escape-quotes">
				<input type="checkbox" name="json-1liner-escape-quotes" id="json-1liner-escape-quotes">
				Escape the quotes
			</label>
			<a class="copy"><span>COPY</span><i class="far fa-copy"></i></a>
		</div>
		<input type="text" name="json-1liner" id="json-1liner" spellcheck="false" disabled>
		
		<label for="json-pretty">Pretty JSON</label>
		<div class="subcontrols" data-for="json-pretty">
			<label for="">Indent with</label>
			<label for="json-pretty-indent-tabs"><input type="radio" name="json-pretty-indent" id="json-pretty-indent-tabs" value="	" checked>tabs</label>
			<label for="json-pretty-indent-4spaces"><input type="radio" name="json-pretty-indent" id="json-pretty-indent-4spaces" value="    ">4 spaces</label>
			<label for="json-pretty-indent-2spaces"><input type="radio" name="json-pretty-indent" id="json-pretty-indent-2spaces" value="  ">2 spaces</label>
			<a class="copy"><span>COPY</span><i class="far fa-copy"></i></a>
		</div>
		<textarea id="json-pretty" rows="8" spellcheck="false" disabled></textarea>
	</div>
	
	<script>
		let json = new Tool("json", {
			inJSON: (e) => e.querySelectorAll('.jsonInput')[0],
			outPretty: (e) => e.querySelectorAll('#json-pretty')[0],
			out1liner: (e) => e.querySelectorAll('#json-1liner')[0],
			indentRadios: (e) => e.querySelectorAll('input[name=json-pretty-indent]'),
			switches: (e) => e.querySelectorAll('input[type=radio],input[type=checkbox]'),
			quoteCheck: (e) => document.getElementById('json-1liner-quote-identifiers'),
			escapeQuotesCheck: (e) => document.getElementById('json-1liner-escape-quotes'),
			err: (e) => e.querySelectorAll('.jsonErr')[0],
		});

		json.prettyPrint = function(v) {
			if (v) {
				let indent = "\t";
				for (let r of json.indentRadios) {
					if (r.checked) {
						indent = r.value;
					}
				}

				json.outPretty.value = JSON.stringify(v, null, indent);
			}
		};

		json.oneliner = function(v) {
			if (v) {
				json.out1liner.value = JSON1Liner(undefined, v, json.quoteCheck.checked, json.escapeQuotesCheck.checked);
			}
		}

		json.update = () => {
			let v;
			try {
				v = JSON.parse(json.inJSON.value);
				json.Error('jsonErr', '');
			} catch (e) {
				json.Error('jsonErr', e.message);
			}

			json.prettyPrint(v);
			json.oneliner(v);
		}

		for (let s of json.switches) {
			s.onchange = json.update;
		}

		function JSON1Liner(name, v, quote, escapeQuotes) {
			let namePrefix = '';
			name && (namePrefix = name);
			name && quote && (namePrefix = escapeQuotes ? `\\"${namePrefix}\\"` : `"${namePrefix}"`);
			namePrefix && (namePrefix += ':');

			switch (typeof v) {
				case 'string':
					return `${namePrefix}"${v}"`;

				case 'number':
					return namePrefix + v.toString();

				case 'object':
					if (v instanceof Array) {
						return `${namePrefix}[` + v.map((vv) => JSON1Liner(undefined, vv, quote, escapeQuotes)).join(',') + "]";
					} else {
						return `${namePrefix}{` + Object.keys(v).map((vk) => JSON1Liner(vk, v[vk], quote, escapeQuotes)) + "}";
					}
					break
			}
		}

		json.inJSON.oninput = json.inJSON.onchange = json.update;
	</script>
</div>